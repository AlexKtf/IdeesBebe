- name = current_user.is_owner_of?(@product) ? @user.username : current_user.username
- link = current_user.username == name ? product_path(@product.slug) : product_status_index_path(@product.slug)
#conversation
  .ui.grid.stackable
    .row
      .sixteen.wide.column
        .ui.segment.no-box-shadow
          %h2= "Ma conversation avec #{name}"
          %p.about
            = "A propos de "
            = link_to @product.name, link
    .row
      - if current_user.is_owner_of?(@product)
        .five.column.wide
          .ui.segment.no-left-right-padding.status-list
            .ui.vertical.menu
              - @avalaible_status.each do |status|
                - active = status.user == @receiver ? 'active' : ''
                = link_to product_status_path(product_id: @product.slug, id: status.user.slug, anchor: 'last-message'), class: "item teal #{active}" do
                  = status.user.username
                  - count = status.pending_messages_count
                  - if count > 0
                    .ui.label.teal
                      %i.mail.icon
                      = count
      .eleven.wide.column
        .ui.segment.piled.feed
          .messages
            - @messages.includes(:sender).each do |message|
              - if message == @messages.last
                #last-message
              .row
                - align = message.sender == current_user ? 'left' : 'right'
                .message{ style: "text-align: #{align}; float: #{align}" }
                  %p
                    = message.sender == current_user ? 'Vous avez dit :' : "#{message.sender.username} à dit :"
                  %p
                    = message.content
                %div{ style: 'clear: both' }

          - if @product.avalaible?
            - if @status.can_send_message? current_user
              = simple_form_for Message.new, url: product_messages_path(product_id: @product.id), class: 'ui reply form' do |f|
                = f.input :content, label: '', as: :text
                = f.hidden_field :receiver_id, value: @receiver.id
                = f.hidden_field :status_id, value: @status.id
                = f.button :button, class: 'ui fluid blue labeled submit icon button' do
                  %i.icon.edit
                  = 'Répondre'
            - else
              .cant-respond
                = "#{name} n'a pas encore répondu"
